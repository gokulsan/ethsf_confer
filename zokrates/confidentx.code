import "./sha256verify_libsnark_32.code" as SHA256VERIFY32
import "./sum_to_32.code" as SUMTO32
import "./ge_32.code" as GE32

def main(private field bb31, private field bb30, private field bb29, private field bb28, private field bb27, private field bb26, private field bb25, private field bb24, private field bb23, private field bb22, private field bb21, private field bb20, private field bb19, private field bb18, private field bb17, private field bb16, private field bb15, private field bb14, private field bb13, private field bb12, private field bb11, private field bb10, private field bb9, private field bb8, private field bb7, private field bb6, private field bb5, private field bb4, private field bb3, private field bb2, private field bb1, private field bb0, private field ba31, private field ba30, private field ba29, private field ba28, private field ba27, private field ba26, private field ba25, private field ba24, private field ba23, private field ba22, private field ba21, private field ba20, private field ba19, private field ba18, private field ba17, private field ba16, private field ba15, private field ba14, private field ba13, private field ba12, private field ba11, private field ba10, private field ba9, private field ba8, private field ba7, private field ba6, private field ba5, private field ba4, private field ba3, private field ba2, private field ba1, private field ba0, private field v31, private field v30, private field v29, private field v28, private field v27, private field v26, private field v25, private field v24, private field v23, private field v22, private field v21, private field v20, private field v19, private field v18, private field v17, private field v16, private field v15, private field v14, private field v13, private field v12, private field v11, private field v10, private field v9, private field v8, private field v7, private field v6, private field v5, private field v4, private field v3, private field v2, private field v1, private field v0, field hbb255, field hbb254, field hbb253, field hbb252, field hbb251, field hbb250, field hbb249, field hbb248, field hbb247, field hbb246, field hbb245, field hbb244, field hbb243, field hbb242, field hbb241, field hbb240, field hbb239, field hbb238, field hbb237, field hbb236, field hbb235, field hbb234, field hbb233, field hbb232, field hbb231, field hbb230, field hbb229, field hbb228, field hbb227, field hbb226, field hbb225, field hbb224, field hbb223, field hbb222, field hbb221, field hbb220, field hbb219, field hbb218, field hbb217, field hbb216, field hbb215, field hbb214, field hbb213, field hbb212, field hbb211, field hbb210, field hbb209, field hbb208, field hbb207, field hbb206, field hbb205, field hbb204, field hbb203, field hbb202, field hbb201, field hbb200, field hbb199, field hbb198, field hbb197, field hbb196, field hbb195, field hbb194, field hbb193, field hbb192, field hbb191, field hbb190, field hbb189, field hbb188, field hbb187, field hbb186, field hbb185, field hbb184, field hbb183, field hbb182, field hbb181, field hbb180, field hbb179, field hbb178, field hbb177, field hbb176, field hbb175, field hbb174, field hbb173, field hbb172, field hbb171, field hbb170, field hbb169, field hbb168, field hbb167, field hbb166, field hbb165, field hbb164, field hbb163, field hbb162, field hbb161, field hbb160, field hbb159, field hbb158, field hbb157, field hbb156, field hbb155, field hbb154, field hbb153, field hbb152, field hbb151, field hbb150, field hbb149, field hbb148, field hbb147, field hbb146, field hbb145, field hbb144, field hbb143, field hbb142, field hbb141, field hbb140, field hbb139, field hbb138, field hbb137, field hbb136, field hbb135, field hbb134, field hbb133, field hbb132, field hbb131, field hbb130, field hbb129, field hbb128, field hbb127, field hbb126, field hbb125, field hbb124, field hbb123, field hbb122, field hbb121, field hbb120, field hbb119, field hbb118, field hbb117, field hbb116, field hbb115, field hbb114, field hbb113, field hbb112, field hbb111, field hbb110, field hbb109, field hbb108, field hbb107, field hbb106, field hbb105, field hbb104, field hbb103, field hbb102, field hbb101, field hbb100, field hbb99, field hbb98, field hbb97, field hbb96, field hbb95, field hbb94, field hbb93, field hbb92, field hbb91, field hbb90, field hbb89, field hbb88, field hbb87, field hbb86, field hbb85, field hbb84, field hbb83, field hbb82, field hbb81, field hbb80, field hbb79, field hbb78, field hbb77, field hbb76, field hbb75, field hbb74, field hbb73, field hbb72, field hbb71, field hbb70, field hbb69, field hbb68, field hbb67, field hbb66, field hbb65, field hbb64, field hbb63, field hbb62, field hbb61, field hbb60, field hbb59, field hbb58, field hbb57, field hbb56, field hbb55, field hbb54, field hbb53, field hbb52, field hbb51, field hbb50, field hbb49, field hbb48, field hbb47, field hbb46, field hbb45, field hbb44, field hbb43, field hbb42, field hbb41, field hbb40, field hbb39, field hbb38, field hbb37, field hbb36, field hbb35, field hbb34, field hbb33, field hbb32, field hbb31, field hbb30, field hbb29, field hbb28, field hbb27, field hbb26, field hbb25, field hbb24, field hbb23, field hbb22, field hbb21, field hbb20, field hbb19, field hbb18, field hbb17, field hbb16, field hbb15, field hbb14, field hbb13, field hbb12, field hbb11, field hbb10, field hbb9, field hbb8, field hbb7, field hbb6, field hbb5, field hbb4, field hbb3, field hbb2, field hbb1, field hbb0, field hba255, field hba254, field hba253, field hba252, field hba251, field hba250, field hba249, field hba248, field hba247, field hba246, field hba245, field hba244, field hba243, field hba242, field hba241, field hba240, field hba239, field hba238, field hba237, field hba236, field hba235, field hba234, field hba233, field hba232, field hba231, field hba230, field hba229, field hba228, field hba227, field hba226, field hba225, field hba224, field hba223, field hba222, field hba221, field hba220, field hba219, field hba218, field hba217, field hba216, field hba215, field hba214, field hba213, field hba212, field hba211, field hba210, field hba209, field hba208, field hba207, field hba206, field hba205, field hba204, field hba203, field hba202, field hba201, field hba200, field hba199, field hba198, field hba197, field hba196, field hba195, field hba194, field hba193, field hba192, field hba191, field hba190, field hba189, field hba188, field hba187, field hba186, field hba185, field hba184, field hba183, field hba182, field hba181, field hba180, field hba179, field hba178, field hba177, field hba176, field hba175, field hba174, field hba173, field hba172, field hba171, field hba170, field hba169, field hba168, field hba167, field hba166, field hba165, field hba164, field hba163, field hba162, field hba161, field hba160, field hba159, field hba158, field hba157, field hba156, field hba155, field hba154, field hba153, field hba152, field hba151, field hba150, field hba149, field hba148, field hba147, field hba146, field hba145, field hba144, field hba143, field hba142, field hba141, field hba140, field hba139, field hba138, field hba137, field hba136, field hba135, field hba134, field hba133, field hba132, field hba131, field hba130, field hba129, field hba128, field hba127, field hba126, field hba125, field hba124, field hba123, field hba122, field hba121, field hba120, field hba119, field hba118, field hba117, field hba116, field hba115, field hba114, field hba113, field hba112, field hba111, field hba110, field hba109, field hba108, field hba107, field hba106, field hba105, field hba104, field hba103, field hba102, field hba101, field hba100, field hba99, field hba98, field hba97, field hba96, field hba95, field hba94, field hba93, field hba92, field hba91, field hba90, field hba89, field hba88, field hba87, field hba86, field hba85, field hba84, field hba83, field hba82, field hba81, field hba80, field hba79, field hba78, field hba77, field hba76, field hba75, field hba74, field hba73, field hba72, field hba71, field hba70, field hba69, field hba68, field hba67, field hba66, field hba65, field hba64, field hba63, field hba62, field hba61, field hba60, field hba59, field hba58, field hba57, field hba56, field hba55, field hba54, field hba53, field hba52, field hba51, field hba50, field hba49, field hba48, field hba47, field hba46, field hba45, field hba44, field hba43, field hba42, field hba41, field hba40, field hba39, field hba38, field hba37, field hba36, field hba35, field hba34, field hba33, field hba32, field hba31, field hba30, field hba29, field hba28, field hba27, field hba26, field hba25, field hba24, field hba23, field hba22, field hba21, field hba20, field hba19, field hba18, field hba17, field hba16, field hba15, field hba14, field hba13, field hba12, field hba11, field hba10, field hba9, field hba8, field hba7, field hba6, field hba5, field hba4, field hba3, field hba2, field hba1, field hba0, field hv255, field hv254, field hv253, field hv252, field hv251, field hv250, field hv249, field hv248, field hv247, field hv246, field hv245, field hv244, field hv243, field hv242, field hv241, field hv240, field hv239, field hv238, field hv237, field hv236, field hv235, field hv234, field hv233, field hv232, field hv231, field hv230, field hv229, field hv228, field hv227, field hv226, field hv225, field hv224, field hv223, field hv222, field hv221, field hv220, field hv219, field hv218, field hv217, field hv216, field hv215, field hv214, field hv213, field hv212, field hv211, field hv210, field hv209, field hv208, field hv207, field hv206, field hv205, field hv204, field hv203, field hv202, field hv201, field hv200, field hv199, field hv198, field hv197, field hv196, field hv195, field hv194, field hv193, field hv192, field hv191, field hv190, field hv189, field hv188, field hv187, field hv186, field hv185, field hv184, field hv183, field hv182, field hv181, field hv180, field hv179, field hv178, field hv177, field hv176, field hv175, field hv174, field hv173, field hv172, field hv171, field hv170, field hv169, field hv168, field hv167, field hv166, field hv165, field hv164, field hv163, field hv162, field hv161, field hv160, field hv159, field hv158, field hv157, field hv156, field hv155, field hv154, field hv153, field hv152, field hv151, field hv150, field hv149, field hv148, field hv147, field hv146, field hv145, field hv144, field hv143, field hv142, field hv141, field hv140, field hv139, field hv138, field hv137, field hv136, field hv135, field hv134, field hv133, field hv132, field hv131, field hv130, field hv129, field hv128, field hv127, field hv126, field hv125, field hv124, field hv123, field hv122, field hv121, field hv120, field hv119, field hv118, field hv117, field hv116, field hv115, field hv114, field hv113, field hv112, field hv111, field hv110, field hv109, field hv108, field hv107, field hv106, field hv105, field hv104, field hv103, field hv102, field hv101, field hv100, field hv99, field hv98, field hv97, field hv96, field hv95, field hv94, field hv93, field hv92, field hv91, field hv90, field hv89, field hv88, field hv87, field hv86, field hv85, field hv84, field hv83, field hv82, field hv81, field hv80, field hv79, field hv78, field hv77, field hv76, field hv75, field hv74, field hv73, field hv72, field hv71, field hv70, field hv69, field hv68, field hv67, field hv66, field hv65, field hv64, field hv63, field hv62, field hv61, field hv60, field hv59, field hv58, field hv57, field hv56, field hv55, field hv54, field hv53, field hv52, field hv51, field hv50, field hv49, field hv48, field hv47, field hv46, field hv45, field hv44, field hv43, field hv42, field hv41, field hv40, field hv39, field hv38, field hv37, field hv36, field hv35, field hv34, field hv33, field hv32, field hv31, field hv30, field hv29, field hv28, field hv27, field hv26, field hv25, field hv24, field hv23, field hv22, field hv21, field hv20, field hv19, field hv18, field hv17, field hv16, field hv15, field hv14, field hv13, field hv12, field hv11, field hv10, field hv9, field hv8, field hv7, field hv6, field hv5, field hv4, field hv3, field hv2, field hv1, field hv0, field isSender) -> (field):

  // Verify HASH(balance before)
  bbMatch = SHA256VERIFY32(bb31, bb30, bb29, bb28, bb27, bb26, bb25, bb24, bb23, bb22, bb21, bb20, bb19, bb18, bb17, bb16, bb15, bb14, bb13, bb12, bb11, bb10, bb9, bb8, bb7, bb6, bb5, bb4, bb3, bb2, bb1, bb0, hbb255, hbb254, hbb253, hbb252, hbb251, hbb250, hbb249, hbb248, hbb247, hbb246, hbb245, hbb244, hbb243, hbb242, hbb241, hbb240, hbb239, hbb238, hbb237, hbb236, hbb235, hbb234, hbb233, hbb232, hbb231, hbb230, hbb229, hbb228, hbb227, hbb226, hbb225, hbb224, hbb223, hbb222, hbb221, hbb220, hbb219, hbb218, hbb217, hbb216, hbb215, hbb214, hbb213, hbb212, hbb211, hbb210, hbb209, hbb208, hbb207, hbb206, hbb205, hbb204, hbb203, hbb202, hbb201, hbb200, hbb199, hbb198, hbb197, hbb196, hbb195, hbb194, hbb193, hbb192, hbb191, hbb190, hbb189, hbb188, hbb187, hbb186, hbb185, hbb184, hbb183, hbb182, hbb181, hbb180, hbb179, hbb178, hbb177, hbb176, hbb175, hbb174, hbb173, hbb172, hbb171, hbb170, hbb169, hbb168, hbb167, hbb166, hbb165, hbb164, hbb163, hbb162, hbb161, hbb160, hbb159, hbb158, hbb157, hbb156, hbb155, hbb154, hbb153, hbb152, hbb151, hbb150, hbb149, hbb148, hbb147, hbb146, hbb145, hbb144, hbb143, hbb142, hbb141, hbb140, hbb139, hbb138, hbb137, hbb136, hbb135, hbb134, hbb133, hbb132, hbb131, hbb130, hbb129, hbb128, hbb127, hbb126, hbb125, hbb124, hbb123, hbb122, hbb121, hbb120, hbb119, hbb118, hbb117, hbb116, hbb115, hbb114, hbb113, hbb112, hbb111, hbb110, hbb109, hbb108, hbb107, hbb106, hbb105, hbb104, hbb103, hbb102, hbb101, hbb100, hbb99, hbb98, hbb97, hbb96, hbb95, hbb94, hbb93, hbb92, hbb91, hbb90, hbb89, hbb88, hbb87, hbb86, hbb85, hbb84, hbb83, hbb82, hbb81, hbb80, hbb79, hbb78, hbb77, hbb76, hbb75, hbb74, hbb73, hbb72, hbb71, hbb70, hbb69, hbb68, hbb67, hbb66, hbb65, hbb64, hbb63, hbb62, hbb61, hbb60, hbb59, hbb58, hbb57, hbb56, hbb55, hbb54, hbb53, hbb52, hbb51, hbb50, hbb49, hbb48, hbb47, hbb46, hbb45, hbb44, hbb43, hbb42, hbb41, hbb40, hbb39, hbb38, hbb37, hbb36, hbb35, hbb34, hbb33, hbb32, hbb31, hbb30, hbb29, hbb28, hbb27, hbb26, hbb25, hbb24, hbb23, hbb22, hbb21, hbb20, hbb19, hbb18, hbb17, hbb16, hbb15, hbb14, hbb13, hbb12, hbb11, hbb10, hbb9, hbb8, hbb7, hbb6, hbb5, hbb4, hbb3, hbb2, hbb1, hbb0)
  bbMatch == 1

  // Verify HASH(balance_after)
  baMatch = SHA256VERIFY32(ba31, ba30, ba29, ba28, ba27, ba26, ba25, ba24, ba23, ba22, ba21, ba20, ba19, ba18, ba17, ba16, ba15, ba14, ba13, ba12, ba11, ba10, ba9, ba8, ba7, ba6, ba5, ba4, ba3, ba2, ba1, ba0, hba255, hba254, hba253, hba252, hba251, hba250, hba249, hba248, hba247, hba246, hba245, hba244, hba243, hba242, hba241, hba240, hba239, hba238, hba237, hba236, hba235, hba234, hba233, hba232, hba231, hba230, hba229, hba228, hba227, hba226, hba225, hba224, hba223, hba222, hba221, hba220, hba219, hba218, hba217, hba216, hba215, hba214, hba213, hba212, hba211, hba210, hba209, hba208, hba207, hba206, hba205, hba204, hba203, hba202, hba201, hba200, hba199, hba198, hba197, hba196, hba195, hba194, hba193, hba192, hba191, hba190, hba189, hba188, hba187, hba186, hba185, hba184, hba183, hba182, hba181, hba180, hba179, hba178, hba177, hba176, hba175, hba174, hba173, hba172, hba171, hba170, hba169, hba168, hba167, hba166, hba165, hba164, hba163, hba162, hba161, hba160, hba159, hba158, hba157, hba156, hba155, hba154, hba153, hba152, hba151, hba150, hba149, hba148, hba147, hba146, hba145, hba144, hba143, hba142, hba141, hba140, hba139, hba138, hba137, hba136, hba135, hba134, hba133, hba132, hba131, hba130, hba129, hba128, hba127, hba126, hba125, hba124, hba123, hba122, hba121, hba120, hba119, hba118, hba117, hba116, hba115, hba114, hba113, hba112, hba111, hba110, hba109, hba108, hba107, hba106, hba105, hba104, hba103, hba102, hba101, hba100, hba99, hba98, hba97, hba96, hba95, hba94, hba93, hba92, hba91, hba90, hba89, hba88, hba87, hba86, hba85, hba84, hba83, hba82, hba81, hba80, hba79, hba78, hba77, hba76, hba75, hba74, hba73, hba72, hba71, hba70, hba69, hba68, hba67, hba66, hba65, hba64, hba63, hba62, hba61, hba60, hba59, hba58, hba57, hba56, hba55, hba54, hba53, hba52, hba51, hba50, hba49, hba48, hba47, hba46, hba45, hba44, hba43, hba42, hba41, hba40, hba39, hba38, hba37, hba36, hba35, hba34, hba33, hba32, hba31, hba30, hba29, hba28, hba27, hba26, hba25, hba24, hba23, hba22, hba21, hba20, hba19, hba18, hba17, hba16, hba15, hba14, hba13, hba12, hba11, hba10, hba9, hba8, hba7, hba6, hba5, hba4, hba3, hba2, hba1, hba0)
  baMatch == 1

  // Verify HASH(value)
  vMatch = SHA256VERIFY32(v31, v30, v29, v28, v27, v26, v25, v24, v23, v22, v21, v20, v19, v18, v17, v16, v15, v14, v13, v12, v11, v10, v9, v8, v7, v6, v5, v4, v3, v2, v1, v0, hv255, hv254, hv253, hv252, hv251, hv250, hv249, hv248, hv247, hv246, hv245, hv244, hv243, hv242, hv241, hv240, hv239, hv238, hv237, hv236, hv235, hv234, hv233, hv232, hv231, hv230, hv229, hv228, hv227, hv226, hv225, hv224, hv223, hv222, hv221, hv220, hv219, hv218, hv217, hv216, hv215, hv214, hv213, hv212, hv211, hv210, hv209, hv208, hv207, hv206, hv205, hv204, hv203, hv202, hv201, hv200, hv199, hv198, hv197, hv196, hv195, hv194, hv193, hv192, hv191, hv190, hv189, hv188, hv187, hv186, hv185, hv184, hv183, hv182, hv181, hv180, hv179, hv178, hv177, hv176, hv175, hv174, hv173, hv172, hv171, hv170, hv169, hv168, hv167, hv166, hv165, hv164, hv163, hv162, hv161, hv160, hv159, hv158, hv157, hv156, hv155, hv154, hv153, hv152, hv151, hv150, hv149, hv148, hv147, hv146, hv145, hv144, hv143, hv142, hv141, hv140, hv139, hv138, hv137, hv136, hv135, hv134, hv133, hv132, hv131, hv130, hv129, hv128, hv127, hv126, hv125, hv124, hv123, hv122, hv121, hv120, hv119, hv118, hv117, hv116, hv115, hv114, hv113, hv112, hv111, hv110, hv109, hv108, hv107, hv106, hv105, hv104, hv103, hv102, hv101, hv100, hv99, hv98, hv97, hv96, hv95, hv94, hv93, hv92, hv91, hv90, hv89, hv88, hv87, hv86, hv85, hv84, hv83, hv82, hv81, hv80, hv79, hv78, hv77, hv76, hv75, hv74, hv73, hv72, hv71, hv70, hv69, hv68, hv67, hv66, hv65, hv64, hv63, hv62, hv61, hv60, hv59, hv58, hv57, hv56, hv55, hv54, hv53, hv52, hv51, hv50, hv49, hv48, hv47, hv46, hv45, hv44, hv43, hv42, hv41, hv40, hv39, hv38, hv37, hv36, hv35, hv34, hv33, hv32, hv31, hv30, hv29, hv28, hv27, hv26, hv25, hv24, hv23, hv22, hv21, hv20, hv19, hv18, hv17, hv16, hv15, hv14, hv13, hv12, hv11, hv10, hv9, hv8, hv7, hv6, hv5, hv4, hv3, hv2, hv1, hv0)
  vMatch == 1


  // Verify sender has enough balance
  field hasBalance = if isSender == 1 then GE32(bb31, bb30, bb29, bb28, bb27, bb26, bb25, bb24, bb23, bb22, bb21, bb20, bb19, bb18, bb17, bb16, bb15, bb14, bb13, bb12, bb11, bb10, bb9, bb8, bb7, bb6, bb5, bb4, bb3, bb2, bb1, bb0, v31, v30, v29, v28, v27, v26, v25, v24, v23, v22, v21, v20, v19, v18, v17, v16, v15, v14, v13, v12, v11, v10, v9, v8, v7, v6, v5, v4, v3, v2, v1, v0) else 1 fi
  hasBalance == 1

  // Verify sender/receiver balance difference
  field bMatch = if isSender == 1 then SUMTO32(ba31, ba30, ba29, ba28, ba27, ba26, ba25, ba24, ba23, ba22, ba21, ba20, ba19, ba18, ba17, ba16, ba15, ba14, ba13, ba12, ba11, ba10, ba9, ba8, ba7, ba6, ba5, ba4, ba3, ba2, ba1, ba0, v31, v30, v29, v28, v27, v26, v25, v24, v23, v22, v21, v20, v19, v18, v17, v16, v15, v14, v13, v12, v11, v10, v9, v8, v7, v6, v5, v4, v3, v2, v1, v0, bb31, bb30, bb29, bb28, bb27, bb26, bb25, bb24, bb23, bb22, bb21, bb20, bb19, bb18, bb17, bb16, bb15, bb14, bb13, bb12, bb11, bb10, bb9, bb8, bb7, bb6, bb5, bb4, bb3, bb2, bb1, bb0) else SUMTO32(bb31, bb30, bb29, bb28, bb27, bb26, bb25, bb24, bb23, bb22, bb21, bb20, bb19, bb18, bb17, bb16, bb15, bb14, bb13, bb12, bb11, bb10, bb9, bb8, bb7, bb6, bb5, bb4, bb3, bb2, bb1, bb0, v31, v30, v29, v28, v27, v26, v25, v24, v23, v22, v21, v20, v19, v18, v17, v16, v15, v14, v13, v12, v11, v10, v9, v8, v7, v6, v5, v4, v3, v2, v1, v0, ba31, ba30, ba29, ba28, ba27, ba26, ba25, ba24, ba23, ba22, ba21, ba20, ba19, ba18, ba17, ba16, ba15, ba14, ba13, ba12, ba11, ba10, ba9, ba8, ba7, ba6, ba5, ba4, ba3, ba2, ba1, ba0) fi
  bMatch == 1

  return 1
