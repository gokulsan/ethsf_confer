import "./sha256verify_libsnark_32.code" as SHA256VERIFY32
import "./sum_to_32.code" as SUMTO32
import "./ge_32.code" as GE32

def main(private field bf31, private field bf30, private field bf29, private field bf28, private field bf27, private field bf26, private field bf25, private field bf24, private field bf23, private field bf22, private field bf21, private field bf20, private field bf19, private field bf18, private field bf17, private field bf16, private field bf15, private field bf14, private field bf13, private field bf12, private field bf11, private field bf10, private field bf9, private field bf8, private field bf7, private field bf6, private field bf5, private field bf4, private field bf3, private field bf2, private field bf1, private field bf0, private field ba31, private field ba30, private field ba29, private field ba28, private field ba27, private field ba26, private field ba25, private field ba24, private field ba23, private field ba22, private field ba21, private field ba20, private field ba19, private field ba18, private field ba17, private field ba16, private field ba15, private field ba14, private field ba13, private field ba12, private field ba11, private field ba10, private field ba9, private field ba8, private field ba7, private field ba6, private field ba5, private field ba4, private field ba3, private field ba2, private field ba1, private field ba0, private field v31, private field v30, private field v29, private field v28, private field v27, private field v26, private field v25, private field v24, private field v23, private field v22, private field v21, private field v20, private field v19, private field v18, private field v17, private field v16, private field v15, private field v14, private field v13, private field v12, private field v11, private field v10, private field v9, private field v8, private field v7, private field v6, private field v5, private field v4, private field v3, private field v2, private field v1, private field v0, field hbf255, field hbf254, field hbf253, field hbf252, field hbf251, field hbf250, field hbf249, field hbf248, field hbf247, field hbf246, field hbf245, field hbf244, field hbf243, field hbf242, field hbf241, field hbf240, field hbf239, field hbf238, field hbf237, field hbf236, field hbf235, field hbf234, field hbf233, field hbf232, field hbf231, field hbf230, field hbf229, field hbf228, field hbf227, field hbf226, field hbf225, field hbf224, field hbf223, field hbf222, field hbf221, field hbf220, field hbf219, field hbf218, field hbf217, field hbf216, field hbf215, field hbf214, field hbf213, field hbf212, field hbf211, field hbf210, field hbf209, field hbf208, field hbf207, field hbf206, field hbf205, field hbf204, field hbf203, field hbf202, field hbf201, field hbf200, field hbf199, field hbf198, field hbf197, field hbf196, field hbf195, field hbf194, field hbf193, field hbf192, field hbf191, field hbf190, field hbf189, field hbf188, field hbf187, field hbf186, field hbf185, field hbf184, field hbf183, field hbf182, field hbf181, field hbf180, field hbf179, field hbf178, field hbf177, field hbf176, field hbf175, field hbf174, field hbf173, field hbf172, field hbf171, field hbf170, field hbf169, field hbf168, field hbf167, field hbf166, field hbf165, field hbf164, field hbf163, field hbf162, field hbf161, field hbf160, field hbf159, field hbf158, field hbf157, field hbf156, field hbf155, field hbf154, field hbf153, field hbf152, field hbf151, field hbf150, field hbf149, field hbf148, field hbf147, field hbf146, field hbf145, field hbf144, field hbf143, field hbf142, field hbf141, field hbf140, field hbf139, field hbf138, field hbf137, field hbf136, field hbf135, field hbf134, field hbf133, field hbf132, field hbf131, field hbf130, field hbf129, field hbf128, field hbf127, field hbf126, field hbf125, field hbf124, field hbf123, field hbf122, field hbf121, field hbf120, field hbf119, field hbf118, field hbf117, field hbf116, field hbf115, field hbf114, field hbf113, field hbf112, field hbf111, field hbf110, field hbf109, field hbf108, field hbf107, field hbf106, field hbf105, field hbf104, field hbf103, field hbf102, field hbf101, field hbf100, field hbf99, field hbf98, field hbf97, field hbf96, field hbf95, field hbf94, field hbf93, field hbf92, field hbf91, field hbf90, field hbf89, field hbf88, field hbf87, field hbf86, field hbf85, field hbf84, field hbf83, field hbf82, field hbf81, field hbf80, field hbf79, field hbf78, field hbf77, field hbf76, field hbf75, field hbf74, field hbf73, field hbf72, field hbf71, field hbf70, field hbf69, field hbf68, field hbf67, field hbf66, field hbf65, field hbf64, field hbf63, field hbf62, field hbf61, field hbf60, field hbf59, field hbf58, field hbf57, field hbf56, field hbf55, field hbf54, field hbf53, field hbf52, field hbf51, field hbf50, field hbf49, field hbf48, field hbf47, field hbf46, field hbf45, field hbf44, field hbf43, field hbf42, field hbf41, field hbf40, field hbf39, field hbf38, field hbf37, field hbf36, field hbf35, field hbf34, field hbf33, field hbf32, field hbf31, field hbf30, field hbf29, field hbf28, field hbf27, field hbf26, field hbf25, field hbf24, field hbf23, field hbf22, field hbf21, field hbf20, field hbf19, field hbf18, field hbf17, field hbf16, field hbf15, field hbf14, field hbf13, field hbf12, field hbf11, field hbf10, field hbf9, field hbf8, field hbf7, field hbf6, field hbf5, field hbf4, field hbf3, field hbf2, field hbf1, field hbf0, field hba255, field hba254, field hba253, field hba252, field hba251, field hba250, field hba249, field hba248, field hba247, field hba246, field hba245, field hba244, field hba243, field hba242, field hba241, field hba240, field hba239, field hba238, field hba237, field hba236, field hba235, field hba234, field hba233, field hba232, field hba231, field hba230, field hba229, field hba228, field hba227, field hba226, field hba225, field hba224, field hba223, field hba222, field hba221, field hba220, field hba219, field hba218, field hba217, field hba216, field hba215, field hba214, field hba213, field hba212, field hba211, field hba210, field hba209, field hba208, field hba207, field hba206, field hba205, field hba204, field hba203, field hba202, field hba201, field hba200, field hba199, field hba198, field hba197, field hba196, field hba195, field hba194, field hba193, field hba192, field hba191, field hba190, field hba189, field hba188, field hba187, field hba186, field hba185, field hba184, field hba183, field hba182, field hba181, field hba180, field hba179, field hba178, field hba177, field hba176, field hba175, field hba174, field hba173, field hba172, field hba171, field hba170, field hba169, field hba168, field hba167, field hba166, field hba165, field hba164, field hba163, field hba162, field hba161, field hba160, field hba159, field hba158, field hba157, field hba156, field hba155, field hba154, field hba153, field hba152, field hba151, field hba150, field hba149, field hba148, field hba147, field hba146, field hba145, field hba144, field hba143, field hba142, field hba141, field hba140, field hba139, field hba138, field hba137, field hba136, field hba135, field hba134, field hba133, field hba132, field hba131, field hba130, field hba129, field hba128, field hba127, field hba126, field hba125, field hba124, field hba123, field hba122, field hba121, field hba120, field hba119, field hba118, field hba117, field hba116, field hba115, field hba114, field hba113, field hba112, field hba111, field hba110, field hba109, field hba108, field hba107, field hba106, field hba105, field hba104, field hba103, field hba102, field hba101, field hba100, field hba99, field hba98, field hba97, field hba96, field hba95, field hba94, field hba93, field hba92, field hba91, field hba90, field hba89, field hba88, field hba87, field hba86, field hba85, field hba84, field hba83, field hba82, field hba81, field hba80, field hba79, field hba78, field hba77, field hba76, field hba75, field hba74, field hba73, field hba72, field hba71, field hba70, field hba69, field hba68, field hba67, field hba66, field hba65, field hba64, field hba63, field hba62, field hba61, field hba60, field hba59, field hba58, field hba57, field hba56, field hba55, field hba54, field hba53, field hba52, field hba51, field hba50, field hba49, field hba48, field hba47, field hba46, field hba45, field hba44, field hba43, field hba42, field hba41, field hba40, field hba39, field hba38, field hba37, field hba36, field hba35, field hba34, field hba33, field hba32, field hba31, field hba30, field hba29, field hba28, field hba27, field hba26, field hba25, field hba24, field hba23, field hba22, field hba21, field hba20, field hba19, field hba18, field hba17, field hba16, field hba15, field hba14, field hba13, field hba12, field hba11, field hba10, field hba9, field hba8, field hba7, field hba6, field hba5, field hba4, field hba3, field hba2, field hba1, field hba0, field hv255, field hv254, field hv253, field hv252, field hv251, field hv250, field hv249, field hv248, field hv247, field hv246, field hv245, field hv244, field hv243, field hv242, field hv241, field hv240, field hv239, field hv238, field hv237, field hv236, field hv235, field hv234, field hv233, field hv232, field hv231, field hv230, field hv229, field hv228, field hv227, field hv226, field hv225, field hv224, field hv223, field hv222, field hv221, field hv220, field hv219, field hv218, field hv217, field hv216, field hv215, field hv214, field hv213, field hv212, field hv211, field hv210, field hv209, field hv208, field hv207, field hv206, field hv205, field hv204, field hv203, field hv202, field hv201, field hv200, field hv199, field hv198, field hv197, field hv196, field hv195, field hv194, field hv193, field hv192, field hv191, field hv190, field hv189, field hv188, field hv187, field hv186, field hv185, field hv184, field hv183, field hv182, field hv181, field hv180, field hv179, field hv178, field hv177, field hv176, field hv175, field hv174, field hv173, field hv172, field hv171, field hv170, field hv169, field hv168, field hv167, field hv166, field hv165, field hv164, field hv163, field hv162, field hv161, field hv160, field hv159, field hv158, field hv157, field hv156, field hv155, field hv154, field hv153, field hv152, field hv151, field hv150, field hv149, field hv148, field hv147, field hv146, field hv145, field hv144, field hv143, field hv142, field hv141, field hv140, field hv139, field hv138, field hv137, field hv136, field hv135, field hv134, field hv133, field hv132, field hv131, field hv130, field hv129, field hv128, field hv127, field hv126, field hv125, field hv124, field hv123, field hv122, field hv121, field hv120, field hv119, field hv118, field hv117, field hv116, field hv115, field hv114, field hv113, field hv112, field hv111, field hv110, field hv109, field hv108, field hv107, field hv106, field hv105, field hv104, field hv103, field hv102, field hv101, field hv100, field hv99, field hv98, field hv97, field hv96, field hv95, field hv94, field hv93, field hv92, field hv91, field hv90, field hv89, field hv88, field hv87, field hv86, field hv85, field hv84, field hv83, field hv82, field hv81, field hv80, field hv79, field hv78, field hv77, field hv76, field hv75, field hv74, field hv73, field hv72, field hv71, field hv70, field hv69, field hv68, field hv67, field hv66, field hv65, field hv64, field hv63, field hv62, field hv61, field hv60, field hv59, field hv58, field hv57, field hv56, field hv55, field hv54, field hv53, field hv52, field hv51, field hv50, field hv49, field hv48, field hv47, field hv46, field hv45, field hv44, field hv43, field hv42, field hv41, field hv40, field hv39, field hv38, field hv37, field hv36, field hv35, field hv34, field hv33, field hv32, field hv31, field hv30, field hv29, field hv28, field hv27, field hv26, field hv25, field hv24, field hv23, field hv22, field hv21, field hv20, field hv19, field hv18, field hv17, field hv16, field hv15, field hv14, field hv13, field hv12, field hv11, field hv10, field hv9, field hv8, field hv7, field hv6, field hv5, field hv4, field hv3, field hv2, field hv1, field hv0, field isSender) -> (field):

  // Verify HASH(balance before)
  bfMatch = SHA256VERIFY32(bf31, bf30, bf29, bf28, bf27, bf26, bf25, bf24, bf23, bf22, bf21, bf20, bf19, bf18, bf17, bf16, bf15, bf14, bf13, bf12, bf11, bf10, bf9, bf8, bf7, bf6, bf5, bf4, bf3, bf2, bf1, bf0, hbf255, hbf254, hbf253, hbf252, hbf251, hbf250, hbf249, hbf248, hbf247, hbf246, hbf245, hbf244, hbf243, hbf242, hbf241, hbf240, hbf239, hbf238, hbf237, hbf236, hbf235, hbf234, hbf233, hbf232, hbf231, hbf230, hbf229, hbf228, hbf227, hbf226, hbf225, hbf224, hbf223, hbf222, hbf221, hbf220, hbf219, hbf218, hbf217, hbf216, hbf215, hbf214, hbf213, hbf212, hbf211, hbf210, hbf209, hbf208, hbf207, hbf206, hbf205, hbf204, hbf203, hbf202, hbf201, hbf200, hbf199, hbf198, hbf197, hbf196, hbf195, hbf194, hbf193, hbf192, hbf191, hbf190, hbf189, hbf188, hbf187, hbf186, hbf185, hbf184, hbf183, hbf182, hbf181, hbf180, hbf179, hbf178, hbf177, hbf176, hbf175, hbf174, hbf173, hbf172, hbf171, hbf170, hbf169, hbf168, hbf167, hbf166, hbf165, hbf164, hbf163, hbf162, hbf161, hbf160, hbf159, hbf158, hbf157, hbf156, hbf155, hbf154, hbf153, hbf152, hbf151, hbf150, hbf149, hbf148, hbf147, hbf146, hbf145, hbf144, hbf143, hbf142, hbf141, hbf140, hbf139, hbf138, hbf137, hbf136, hbf135, hbf134, hbf133, hbf132, hbf131, hbf130, hbf129, hbf128, hbf127, hbf126, hbf125, hbf124, hbf123, hbf122, hbf121, hbf120, hbf119, hbf118, hbf117, hbf116, hbf115, hbf114, hbf113, hbf112, hbf111, hbf110, hbf109, hbf108, hbf107, hbf106, hbf105, hbf104, hbf103, hbf102, hbf101, hbf100, hbf99, hbf98, hbf97, hbf96, hbf95, hbf94, hbf93, hbf92, hbf91, hbf90, hbf89, hbf88, hbf87, hbf86, hbf85, hbf84, hbf83, hbf82, hbf81, hbf80, hbf79, hbf78, hbf77, hbf76, hbf75, hbf74, hbf73, hbf72, hbf71, hbf70, hbf69, hbf68, hbf67, hbf66, hbf65, hbf64, hbf63, hbf62, hbf61, hbf60, hbf59, hbf58, hbf57, hbf56, hbf55, hbf54, hbf53, hbf52, hbf51, hbf50, hbf49, hbf48, hbf47, hbf46, hbf45, hbf44, hbf43, hbf42, hbf41, hbf40, hbf39, hbf38, hbf37, hbf36, hbf35, hbf34, hbf33, hbf32, hbf31, hbf30, hbf29, hbf28, hbf27, hbf26, hbf25, hbf24, hbf23, hbf22, hbf21, hbf20, hbf19, hbf18, hbf17, hbf16, hbf15, hbf14, hbf13, hbf12, hbf11, hbf10, hbf9, hbf8, hbf7, hbf6, hbf5, hbf4, hbf3, hbf2, hbf1, hbf0)
  bfMatch == 1

  // Verify HASH(balance_after)
  baMatch = SHA256VERIFY32(ba31, ba30, ba29, ba28, ba27, ba26, ba25, ba24, ba23, ba22, ba21, ba20, ba19, ba18, ba17, ba16, ba15, ba14, ba13, ba12, ba11, ba10, ba9, ba8, ba7, ba6, ba5, ba4, ba3, ba2, ba1, ba0, hba255, hba254, hba253, hba252, hba251, hba250, hba249, hba248, hba247, hba246, hba245, hba244, hba243, hba242, hba241, hba240, hba239, hba238, hba237, hba236, hba235, hba234, hba233, hba232, hba231, hba230, hba229, hba228, hba227, hba226, hba225, hba224, hba223, hba222, hba221, hba220, hba219, hba218, hba217, hba216, hba215, hba214, hba213, hba212, hba211, hba210, hba209, hba208, hba207, hba206, hba205, hba204, hba203, hba202, hba201, hba200, hba199, hba198, hba197, hba196, hba195, hba194, hba193, hba192, hba191, hba190, hba189, hba188, hba187, hba186, hba185, hba184, hba183, hba182, hba181, hba180, hba179, hba178, hba177, hba176, hba175, hba174, hba173, hba172, hba171, hba170, hba169, hba168, hba167, hba166, hba165, hba164, hba163, hba162, hba161, hba160, hba159, hba158, hba157, hba156, hba155, hba154, hba153, hba152, hba151, hba150, hba149, hba148, hba147, hba146, hba145, hba144, hba143, hba142, hba141, hba140, hba139, hba138, hba137, hba136, hba135, hba134, hba133, hba132, hba131, hba130, hba129, hba128, hba127, hba126, hba125, hba124, hba123, hba122, hba121, hba120, hba119, hba118, hba117, hba116, hba115, hba114, hba113, hba112, hba111, hba110, hba109, hba108, hba107, hba106, hba105, hba104, hba103, hba102, hba101, hba100, hba99, hba98, hba97, hba96, hba95, hba94, hba93, hba92, hba91, hba90, hba89, hba88, hba87, hba86, hba85, hba84, hba83, hba82, hba81, hba80, hba79, hba78, hba77, hba76, hba75, hba74, hba73, hba72, hba71, hba70, hba69, hba68, hba67, hba66, hba65, hba64, hba63, hba62, hba61, hba60, hba59, hba58, hba57, hba56, hba55, hba54, hba53, hba52, hba51, hba50, hba49, hba48, hba47, hba46, hba45, hba44, hba43, hba42, hba41, hba40, hba39, hba38, hba37, hba36, hba35, hba34, hba33, hba32, hba31, hba30, hba29, hba28, hba27, hba26, hba25, hba24, hba23, hba22, hba21, hba20, hba19, hba18, hba17, hba16, hba15, hba14, hba13, hba12, hba11, hba10, hba9, hba8, hba7, hba6, hba5, hba4, hba3, hba2, hba1, hba0)
  baMatch == 1

  // Verify HASH(value)
  vMatch = SHA256VERIFY32(v31, v30, v29, v28, v27, v26, v25, v24, v23, v22, v21, v20, v19, v18, v17, v16, v15, v14, v13, v12, v11, v10, v9, v8, v7, v6, v5, v4, v3, v2, v1, v0, hv255, hv254, hv253, hv252, hv251, hv250, hv249, hv248, hv247, hv246, hv245, hv244, hv243, hv242, hv241, hv240, hv239, hv238, hv237, hv236, hv235, hv234, hv233, hv232, hv231, hv230, hv229, hv228, hv227, hv226, hv225, hv224, hv223, hv222, hv221, hv220, hv219, hv218, hv217, hv216, hv215, hv214, hv213, hv212, hv211, hv210, hv209, hv208, hv207, hv206, hv205, hv204, hv203, hv202, hv201, hv200, hv199, hv198, hv197, hv196, hv195, hv194, hv193, hv192, hv191, hv190, hv189, hv188, hv187, hv186, hv185, hv184, hv183, hv182, hv181, hv180, hv179, hv178, hv177, hv176, hv175, hv174, hv173, hv172, hv171, hv170, hv169, hv168, hv167, hv166, hv165, hv164, hv163, hv162, hv161, hv160, hv159, hv158, hv157, hv156, hv155, hv154, hv153, hv152, hv151, hv150, hv149, hv148, hv147, hv146, hv145, hv144, hv143, hv142, hv141, hv140, hv139, hv138, hv137, hv136, hv135, hv134, hv133, hv132, hv131, hv130, hv129, hv128, hv127, hv126, hv125, hv124, hv123, hv122, hv121, hv120, hv119, hv118, hv117, hv116, hv115, hv114, hv113, hv112, hv111, hv110, hv109, hv108, hv107, hv106, hv105, hv104, hv103, hv102, hv101, hv100, hv99, hv98, hv97, hv96, hv95, hv94, hv93, hv92, hv91, hv90, hv89, hv88, hv87, hv86, hv85, hv84, hv83, hv82, hv81, hv80, hv79, hv78, hv77, hv76, hv75, hv74, hv73, hv72, hv71, hv70, hv69, hv68, hv67, hv66, hv65, hv64, hv63, hv62, hv61, hv60, hv59, hv58, hv57, hv56, hv55, hv54, hv53, hv52, hv51, hv50, hv49, hv48, hv47, hv46, hv45, hv44, hv43, hv42, hv41, hv40, hv39, hv38, hv37, hv36, hv35, hv34, hv33, hv32, hv31, hv30, hv29, hv28, hv27, hv26, hv25, hv24, hv23, hv22, hv21, hv20, hv19, hv18, hv17, hv16, hv15, hv14, hv13, hv12, hv11, hv10, hv9, hv8, hv7, hv6, hv5, hv4, hv3, hv2, hv1, hv0)
  vMatch == 1


  // Verify sender has enough balance
  field hasBalance = if isSender == 1 then GE32(bf7, bf6, bf5, bf4, bf3, bf2, bf1, bf0, bf15, bf14, bf13, bf12, bf11, bf10, bf9, bf8, bf23, bf22, bf21, bf20, bf19, bf18, bf17, bf16, bf31, bf30, bf29, bf28, bf27, bf26, bf25, bf24, v7, v6, v5, v4, v3, v2, v1, v0, v15, v14, v13, v12, v11, v10, v9, v8, v23, v22, v21, v20, v19, v18, v17, v16, v31, v30, v29, v28, v27, v26, v25, v24) else 1 fi
  hasBalance == 1

  // Verify sender/receiver balance difference
  field bMatch = if isSender == 1 then SUMTO32(ba31, ba30, ba29, ba28, ba27, ba26, ba25, ba24, ba23, ba22, ba21, ba20, ba19, ba18, ba17, ba16, ba15, ba14, ba13, ba12, ba11, ba10, ba9, ba8, ba7, ba6, ba5, ba4, ba3, ba2, ba1, ba0, v31, v30, v29, v28, v27, v26, v25, v24, v23, v22, v21, v20, v19, v18, v17, v16, v15, v14, v13, v12, v11, v10, v9, v8, v7, v6, v5, v4, v3, v2, v1, v0, ba31, ba30, ba29, ba28, ba27, ba26, ba25, ba24, ba23, ba22, ba21, ba20, ba19, ba18, ba17, ba16, ba15, ba14, ba13, ba12, ba11, ba10, ba9, ba8, ba7, ba6, ba5, ba4, ba3, ba2, ba1, ba0) else SUMTO32(bf31, bf30, bf29, bf28, bf27, bf26, bf25, bf24, bf23, bf22, bf21, bf20, bf19, bf18, bf17, bf16, bf15, bf14, bf13, bf12, bf11, bf10, bf9, bf8, bf7, bf6, bf5, bf4, bf3, bf2, bf1, bf0, v31, v30, v29, v28, v27, v26, v25, v24, v23, v22, v21, v20, v19, v18, v17, v16, v15, v14, v13, v12, v11, v10, v9, v8, v7, v6, v5, v4, v3, v2, v1, v0, ba31, ba30, ba29, ba28, ba27, ba26, ba25, ba24, ba23, ba22, ba21, ba20, ba19, ba18, ba17, ba16, ba15, ba14, ba13, ba12, ba11, ba10, ba9, ba8, ba7, ba6, ba5, ba4, ba3, ba2, ba1, ba0) fi
  bMatch == 1

  return 1
